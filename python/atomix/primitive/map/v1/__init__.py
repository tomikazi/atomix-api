# Generated by the protocol buffer compiler.  DO NOT EDIT!
# sources: atomix/primitive/map/v1/primitive.proto, atomix/primitive/map/v1/session.proto
# plugin: python-betterproto
from dataclasses import dataclass
from datetime import timedelta
from typing import AsyncIterator, List, Optional

import betterproto
import grpclib


class EventType(betterproto.Enum):
    NONE = 0
    INSERT = 1
    UPDATE = 2
    REMOVE = 3
    REPLAY = 4


class MapCacheStrategy(betterproto.Enum):
    NEAR = 0
    READ_THROUGH = 1
    WRITE_THROUGH = 2
    READ_THROUGH_WRITE_THROUGH = 3


@dataclass(eq=False, repr=False)
class SizeRequest(betterproto.Message):
    pass

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class SizeResponse(betterproto.Message):
    size: int = betterproto.uint32_field(2)

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class Precondition(betterproto.Message):
    metadata: "__meta__.ObjectMeta" = betterproto.message_field(1, group="precondition")

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class PutRequest(betterproto.Message):
    entry: "Entry" = betterproto.message_field(2)
    preconditions: List["Precondition"] = betterproto.message_field(3)

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class PutResponse(betterproto.Message):
    entry: "Entry" = betterproto.message_field(2)

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class GetRequest(betterproto.Message):
    key: str = betterproto.string_field(2)

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class GetResponse(betterproto.Message):
    entry: "Entry" = betterproto.message_field(2)

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class RemoveRequest(betterproto.Message):
    key: "Key" = betterproto.message_field(2)
    preconditions: List["Precondition"] = betterproto.message_field(3)

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class RemoveResponse(betterproto.Message):
    entry: "Entry" = betterproto.message_field(2)

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class ClearRequest(betterproto.Message):
    pass

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class ClearResponse(betterproto.Message):
    pass

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class EntriesRequest(betterproto.Message):
    pass

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class EntriesResponse(betterproto.Message):
    entry: "Entry" = betterproto.message_field(2)

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class EventsRequest(betterproto.Message):
    key: str = betterproto.string_field(2)
    replay: bool = betterproto.bool_field(3)

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class EventsResponse(betterproto.Message):
    event: "Event" = betterproto.message_field(2)

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class Event(betterproto.Message):
    type: "EventType" = betterproto.enum_field(1)
    entry: "Entry" = betterproto.message_field(2)

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class Entry(betterproto.Message):
    key: "Key" = betterproto.message_field(1)
    value: "Value" = betterproto.message_field(2)

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class Key(betterproto.Message):
    meta: "__meta__.ObjectMeta" = betterproto.message_field(1)
    key: str = betterproto.string_field(2)

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class Value(betterproto.Message):
    value: bytes = betterproto.bytes_field(1)
    ttl: timedelta = betterproto.message_field(2)

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class OpenSessionRequest(betterproto.Message):
    options: "MapSessionOptions" = betterproto.message_field(1)

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class OpenSessionResponse(betterproto.Message):
    session_id: str = betterproto.string_field(1)

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class MapSessionOptions(betterproto.Message):
    cache: "MapCacheOptions" = betterproto.message_field(1)

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class MapCacheOptions(betterproto.Message):
    enabled: bool = betterproto.bool_field(1)
    strategy: "MapCacheStrategy" = betterproto.enum_field(2)

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class CloseSessionRequest(betterproto.Message):
    session_id: str = betterproto.string_field(1)

    def __post_init__(self) -> None:
        super().__post_init__()


@dataclass(eq=False, repr=False)
class CloseSessionResponse(betterproto.Message):
    pass

    def __post_init__(self) -> None:
        super().__post_init__()


class MapStub(betterproto.ServiceStub):
    """Map is a service for a map primitive"""

    async def size(self) -> "SizeResponse":
        """Size returns the size of the map"""

        request = SizeRequest()

        return await self._unary_unary(
            "/atomix.primitive.map.v1.Map/Size", request, SizeResponse
        )

    async def put(
        self,
        *,
        entry: "Entry" = None,
        preconditions: Optional[List["Precondition"]] = None,
    ) -> "PutResponse":
        """Put puts an entry into the map"""

        preconditions = preconditions or []

        request = PutRequest()
        if entry is not None:
            request.entry = entry
        if preconditions is not None:
            request.preconditions = preconditions

        return await self._unary_unary(
            "/atomix.primitive.map.v1.Map/Put", request, PutResponse
        )

    async def get(self, *, key: str = "") -> "GetResponse":
        """Get gets the entry for a key"""

        request = GetRequest()
        request.key = key

        return await self._unary_unary(
            "/atomix.primitive.map.v1.Map/Get", request, GetResponse
        )

    async def remove(
        self, *, key: "Key" = None, preconditions: Optional[List["Precondition"]] = None
    ) -> "RemoveResponse":
        """Remove removes an entry from the map"""

        preconditions = preconditions or []

        request = RemoveRequest()
        if key is not None:
            request.key = key
        if preconditions is not None:
            request.preconditions = preconditions

        return await self._unary_unary(
            "/atomix.primitive.map.v1.Map/Remove", request, RemoveResponse
        )

    async def clear(self) -> "ClearResponse":
        """Clear removes all entries from the map"""

        request = ClearRequest()

        return await self._unary_unary(
            "/atomix.primitive.map.v1.Map/Clear", request, ClearResponse
        )

    async def events(
        self, *, key: str = "", replay: bool = False
    ) -> AsyncIterator["EventsResponse"]:
        """Events listens for change events"""

        request = EventsRequest()
        request.key = key
        request.replay = replay

        async for response in self._unary_stream(
            "/atomix.primitive.map.v1.Map/Events",
            request,
            EventsResponse,
        ):
            yield response

    async def entries(self) -> AsyncIterator["EntriesResponse"]:
        """Entries lists all entries in the map"""

        request = EntriesRequest()

        async for response in self._unary_stream(
            "/atomix.primitive.map.v1.Map/Entries",
            request,
            EntriesResponse,
        ):
            yield response


class MapSessionStub(betterproto.ServiceStub):
    """Map is a service for a map primitive"""

    async def open_session(
        self, *, options: "MapSessionOptions" = None
    ) -> "OpenSessionResponse":
        """Size returns the size of the map"""

        request = OpenSessionRequest()
        if options is not None:
            request.options = options

        return await self._unary_unary(
            "/atomix.primitive.map.v1.MapSession/OpenSession",
            request,
            OpenSessionResponse,
        )

    async def close_session(self, *, session_id: str = "") -> "CloseSessionResponse":
        """Put puts an entry into the map"""

        request = CloseSessionRequest()
        request.session_id = session_id

        return await self._unary_unary(
            "/atomix.primitive.map.v1.MapSession/CloseSession",
            request,
            CloseSessionResponse,
        )


from ... import meta as __meta__
